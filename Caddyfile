# Haven Institute - Caddy Configuration
# Automatic HTTPS with Let's Encrypt

# Global security headers (no CORS - backend handles it)
(security_headers) {
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        X-XSS-Protection "1; mode=block"
        -Server
    }
}

# Main domain - Frontend
havenstudy.com {
    import security_headers
    reverse_proxy frontend:80
}

# API subdomain - Backend (CORS handled by backend)
api.havenstudy.com {
    import security_headers
    reverse_proxy backend:3001

    # WebSocket support
    @websockets {
        header Connection *Upgrade*
        header Upgrade websocket
    }
    reverse_proxy @websockets backend:3001
}
